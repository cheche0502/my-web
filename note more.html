<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç”¨æˆ·å­¦ä¹ ç¬”è®°ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --accent-color: #ff7e5f;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
        
        .upload-section {
            flex: 1;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .notes-section {
            flex: 2;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .user-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 10px;
        }
        
        .upload-area {
            border: 2px dashed var(--secondary-color);
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            background-color: rgba(107, 140, 188, 0.05);
        }
        
        .upload-area:hover {
            background-color: rgba(107, 140, 188, 0.1);
            border-color: var(--primary-color);
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .upload-text {
            margin-bottom: 15px;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            display: inline-block;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #ff9a7a;
        }
        
        .preview-container {
            margin-top: 20px;
            text-align: center;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
        }
        
        .note-form {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .notes-list {
            margin-top: 30px;
        }
        
        .note-card {
            background: var(--light-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
        }
        
        .note-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .note-title {
            font-size: 1.3rem;
            color: var(--primary-color);
        }
        
        .note-date {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .note-image {
            max-width: 100%;
            border-radius: 5px;
            margin-bottom: 15px;
            max-height: 200px;
            object-fit: cover;
        }
        
        .note-content {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .note-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .tag {
            display: inline-block;
            background-color: #e9ecef;
            color: #495057;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .tag-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .tag-option {
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            background-color: #e9ecef;
            transition: var(--transition);
        }
        
        .tag-option.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .user-list {
            margin-top: 20px;
        }
        
        .user-card {
            background: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-name {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .switch-user-btn {
            background-color: var(--secondary-color);
        }
        
        .current-user {
            background-color: rgba(74, 111, 165, 0.1);
            border-left: 4px solid var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å¤šç”¨æˆ·å­¦ä¹ ç¬”è®°ç®¡ç†ç³»ç»Ÿ</h1>
            <p class="subtitle">æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ç¬”è®°ç©ºé—´</p>
        </header>
        
        <!-- ç”¨æˆ·ç®¡ç†åŒºåŸŸ -->
        <section class="user-section">
            <h2 class="section-title">ç”¨æˆ·ç®¡ç†</h2>
            <div class="form-group">
                <label for="userName">ç”¨æˆ·å</label>
                <input type="text" id="userName" placeholder="è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·å">
            </div>
            <button class="btn" id="createUserBtn">åˆ›å»º/åˆ‡æ¢åˆ°ç”¨æˆ·</button>
            
            <div class="user-list" id="userList">
                <!-- ç”¨æˆ·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
        </section>
        
        <div class="main-content">
            <section class="upload-section">
                <h2 class="section-title">ä¸Šä¼ å­¦ä¹ èµ„æ–™</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“·</div>
                    <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ </p>
                    <p class="upload-hint">æ”¯æŒ JPG, PNG æ ¼å¼ï¼Œæœ€å¤§ 5MB</p>
                </div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                
                <div class="preview-container" id="previewContainer" style="display: none;">
                    <img id="previewImage" class="preview-image" src="" alt="é¢„è§ˆå›¾ç‰‡">
                    <button class="btn btn-accent" id="removeImageBtn">ç§»é™¤å›¾ç‰‡</button>
                </div>
                
                <div class="tag-selector">
                    <div class="tag-option active" data-tag="å…¨éƒ¨">å…¨éƒ¨</div>
                    <div class="tag-option" data-tag="æ•°å­¦">æ•°å­¦</div>
                    <div class="tag-option" data-tag="ç¼–ç¨‹">ç¼–ç¨‹</div>
                    <div class="tag-option" data-tag="è‹±è¯­">è‹±è¯­</div>
                    <div class="tag-option" data-tag="ç‰©ç†">ç‰©ç†</div>
                    <div class="tag-option" data-tag="å…¶ä»–">å…¶ä»–</div>
                </div>
            </section>
            
            <section class="notes-section">
                <h2 class="section-title">æ·»åŠ å­¦ä¹ ç¬”è®°</h2>
                <div class="note-form">
                    <div class="form-group">
                        <label for="noteTitle">ç¬”è®°æ ‡é¢˜</label>
                        <input type="text" id="noteTitle" placeholder="è¯·è¾“å…¥ç¬”è®°æ ‡é¢˜">
                    </div>
                    
                    <div class="form-group">
                        <label for="noteContent">ç¬”è®°å†…å®¹</label>
                        <textarea id="noteContent" placeholder="è¯·è¾“å…¥ç¬”è®°å†…å®¹..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="noteTags">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                        <input type="text" id="noteTags" placeholder="ä¾‹å¦‚ï¼šæ•°å­¦, å…¬å¼, é‡è¦">
                    </div>
                    
                    <button class="btn" id="saveNoteBtn">ä¿å­˜ç¬”è®°</button>
                </div>
                
                <h2 class="section-title">æˆ‘çš„ç¬”è®°</h2>
                <div class="notes-list" id="notesList">
                    <!-- ç¬”è®°å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <p>æš‚æ— ç¬”è®°ï¼Œè¯·æ·»åŠ æ‚¨çš„ç¬¬ä¸€æ¡å­¦ä¹ ç¬”è®°</p>
                    </div>
                </div>
            </section>
        </div>
        
        <footer>
            <p>å¤šç”¨æˆ·å­¦ä¹ ç¬”è®°ç®¡ç†ç³»ç»Ÿ &copy; 2023 | å½“å‰ç”¨æˆ·: <span id="currentUserDisplay">æœªé€‰æ‹©</span></p>
        </footer>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const noteTitle = document.getElementById('noteTitle');
        const noteContent = document.getElementById('noteContent');
        const noteTags = document.getElementById('noteTags');
        const notesList = document.getElementById('notesList');
        const tagOptions = document.querySelectorAll('.tag-option');
        const userNameInput = document.getElementById('userName');
        const createUserBtn = document.getElementById('createUserBtn');
        const userList = document.getElementById('userList');
        const currentUserDisplay = document.getElementById('currentUserDisplay');
        
        // å½“å‰ä¸Šä¼ çš„å›¾ç‰‡ï¼ˆBase64æ ¼å¼ï¼‰
        let currentImage = null;
        
        // ç”¨æˆ·ç›¸å…³å˜é‡
        let currentUser = localStorage.getItem('currentUser') || null;
        let users = JSON.parse(localStorage.getItem('noteUsers')) || {};
        
        // å½“å‰é€‰ä¸­çš„æ ‡ç­¾
        let currentTag = 'å…¨éƒ¨';
        
        // åˆå§‹åŒ–ç”¨æˆ·ç•Œé¢
        function initUserInterface() {
            if (currentUser) {
                currentUserDisplay.textContent = currentUser;
                renderNotes(); // æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„ç¬”è®°
            } else {
                currentUserDisplay.textContent = 'æœªé€‰æ‹©';
            }
            renderUserList();
        }
        
        // ä¸Šä¼ åŒºåŸŸç‚¹å‡»äº‹ä»¶
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // æ‹–æ”¾åŠŸèƒ½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = 'rgba(107, 140, 188, 0.15)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.backgroundColor = 'rgba(107, 140, 188, 0.05)';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = 'rgba(107, 140, 188, 0.05)';
            
            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                if (file.type.startsWith('image/')) {
                    handleImageUpload(file);
                } else {
                    alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
                }
            }
        });
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                handleImageUpload(file);
            }
        });
        
        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(file) {
            if (file.size > 5 * 1024 * 1024) {
                alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MBï¼');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                currentImage = e.target.result;
                previewImage.src = currentImage;
                previewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
        
        // ç§»é™¤å›¾ç‰‡
        removeImageBtn.addEventListener('click', () => {
            currentImage = null;
            previewContainer.style.display = 'none';
            fileInput.value = '';
        });
        
        // æ ‡ç­¾é€‰æ‹©
        tagOptions.forEach(option => {
            option.addEventListener('click', () => {
                tagOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentTag = option.getAttribute('data-tag');
                renderNotes();
            });
        });
        
        // åˆ›å»º/åˆ‡æ¢åˆ°ç”¨æˆ·
        createUserBtn.addEventListener('click', () => {
            const userName = userNameInput.value.trim();
            
            if (!userName) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åï¼');
                return;
            }
            
            // å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·
            if (!users[userName]) {
                users[userName] = {
                    createdAt: new Date().toISOString(),
                    notes: []
                };
                saveUsersToStorage();
            }
            
            // åˆ‡æ¢åˆ°è¯¥ç”¨æˆ·
            switchToUser(userName);
            userNameInput.value = '';
        });
        
        // åˆ‡æ¢åˆ°æŒ‡å®šç”¨æˆ·
        function switchToUser(userName) {
            currentUser = userName;
            localStorage.setItem('currentUser', currentUser);
            currentUserDisplay.textContent = currentUser;
            renderUserList();
            renderNotes();
        }
        
        // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
        function renderUserList() {
            userList.innerHTML = '';
            
            Object.keys(users).forEach(userName => {
                const userCard = document.createElement('div');
                userCard.className = `user-card ${userName === currentUser ? 'current-user' : ''}`;
                
                userCard.innerHTML = `
                    <div>
                        <span class="user-name">${userName}</span>
                        <div>åˆ›å»ºäº: ${new Date(users[userName].createdAt).toLocaleDateString()}</div>
                        <div>ç¬”è®°æ•°é‡: ${users[userName].notes.length}</div>
                    </div>
                    <button class="btn btn-small switch-user-btn" data-user="${userName}">
                        ${userName === currentUser ? 'å½“å‰ç”¨æˆ·' : 'åˆ‡æ¢åˆ°è¯¥ç”¨æˆ·'}
                    </button>
                `;
                
                userList.appendChild(userCard);
            });
            
            // æ·»åŠ åˆ‡æ¢ç”¨æˆ·äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.switch-user-btn').forEach(btn => {
                if (!btn.textContent.includes('å½“å‰ç”¨æˆ·')) {
                    btn.addEventListener('click', (e) => {
                        const targetUser = e.target.getAttribute('data-user');
                        switchToUser(targetUser);
                    });
                }
            });
        }
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveUsersToStorage() {
            localStorage.setItem('noteUsers', JSON.stringify(users));
        }
        
        // ä¿å­˜ç¬”è®°
        saveNoteBtn.addEventListener('click', () => {
            if (!currentUser) {
                alert('è¯·å…ˆé€‰æ‹©æˆ–åˆ›å»ºç”¨æˆ·ï¼');
                return;
            }
            
            const title = noteTitle.value.trim();
            const content = noteContent.value.trim();
            const tags = noteTags.value.split(',').map(tag => tag.trim()).filter(tag => tag);
            
            if (!title) {
                alert('è¯·è¾“å…¥ç¬”è®°æ ‡é¢˜ï¼');
                return;
            }
            
            if (!content) {
                alert('è¯·è¾“å…¥ç¬”è®°å†…å®¹ï¼');
                return;
            }
            
            const newNote = {
                id: Date.now(),
                title,
                content,
                tags,
                image: currentImage,
                date: new Date().toLocaleDateString('zh-CN')
            };
            
            users[currentUser].notes.unshift(newNote);
            saveUsersToStorage();
            renderNotes();
            
            // é‡ç½®è¡¨å•
            noteTitle.value = '';
            noteContent.value = '';
            noteTags.value = '';
            currentImage = null;
            previewContainer.style.display = 'none';
            fileInput.value = '';
            
            alert('ç¬”è®°ä¿å­˜æˆåŠŸï¼');
        });
        
        // æ¸²æŸ“ç¬”è®°åˆ—è¡¨
        function renderNotes() {
            notesList.innerHTML = '';
            
            if (!currentUser) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ‘¤</div>
                        <p>è¯·å…ˆé€‰æ‹©æˆ–åˆ›å»ºç”¨æˆ·</p>
                    </div>
                `;
                return;
            }
            
            let userNotes = users[currentUser].notes;
            
            // è¿‡æ»¤ç¬”è®°
            let filteredNotes = userNotes;
            if (currentTag !== 'å…¨éƒ¨') {
                filteredNotes = userNotes.filter(note => 
                    note.tags.includes(currentTag)
                );
            }
            
            if (filteredNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <p>æš‚æ— ç›¸å…³ç¬”è®°</p>
                    </div>
                `;
                return;
            }
            
            filteredNotes.forEach(note => {
                const noteCard = document.createElement('div');
                noteCard.className = 'note-card';
                
                const tagsHtml = note.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                
                noteCard.innerHTML = `
                    <div class="note-header">
                        <h3 class="note-title">${note.title}</h3>
                        <span class="note-date">${note.date}</span>
                    </div>
                    ${note.image ? `<img src="${note.image}" class="note-image" alt="ç¬”è®°å›¾ç‰‡">` : ''}
                    <div class="note-content">${note.content}</div>
                    <div class="note-tags">${tagsHtml}</div>
                    <div class="note-actions">
                        <button class="btn btn-small edit-btn" data-id="${note.id}">ç¼–è¾‘</button>
                        <button class="btn btn-small btn-accent delete-btn" data-id="${note.id}">åˆ é™¤</button>
                    </div>
                `;
                
                notesList.appendChild(noteCard);
            });
            
            // æ·»åŠ åˆ é™¤å’Œç¼–è¾‘äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ')) {
                        users[currentUser].notes = users[currentUser].notes.filter(note => note.id !== id);
                        saveUsersToStorage();
                        renderNotes();
                    }
                });
            });
            
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    const note = users[currentUser].notes.find(note => note.id === id);
                    
                    if (note) {
                        noteTitle.value = note.title;
                        noteContent.value = note.content;
                        noteTags.value = note.tags.join(', ');
                        
                        if (note.image) {
                            currentImage = note.image;
                            previewImage.src = currentImage;
                            previewContainer.style.display = 'block';
                        }
                        
                        // åˆ é™¤åŸç¬”è®°
                        users[currentUser].notes = users[currentUser].notes.filter(n => n.id !== id);
                        saveUsersToStorage();
                        renderNotes();
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–é¡µé¢
        initUserInterface();
    </script>
</body>
</html>